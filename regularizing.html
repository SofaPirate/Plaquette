

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Regularizing Signals &mdash; Plaquette 0.6.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=bc01728b" />

  
    <link rel="shortcut icon" href="_static/plaquette-favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2bd037f0"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced Usage" href="advanced.html" />
    <link rel="prev" title="Working with Time" href="timing_basics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Plaquette
              <img src="_static/Plaquette-LogoText.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="why_plaquette.html">Why Plaquette?</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs_outputs.html">Inputs and Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="waves.html">Using Waves</a></li>
<li class="toctree-l1"><a class="reference internal" href="timing_basics.html">Working with Time</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Regularizing Signals</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-1-direct-input-to-output">Step 1 : Direct Input-to-Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-getting-the-full-range-of-the-signal">Step 2 : Getting the Full Range of the Signal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-reacting-to-signal-changes">Step 3 : Reacting to Signal Changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-adapting-to-changing-conditions">Step 4 : Adapting to Changing Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-5-detecting-outliers">Step 5 : Detecting Outliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-6-detecting-peaks">Step 6 : Detecting Peaks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="base_units.html">Base Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="generators.html">Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="timing.html">Timing</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="extra.html">Extra</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Plaquette</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Regularizing Signals</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="regularizing-signals">
<h1>Regularizing Signals<a class="headerlink" href="#regularizing-signals" title="Link to this heading"></a></h1>
<p>Plaquette provides expressive, automated, and robust ways to deal with signals
for interactive design using <strong>regularization filters</strong> such as smoothing,
min-max scaling, and normalization.</p>
<p>Here is a simple Arduino code that allows one to change the value of an output
LED using an input photocell:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// The photocell analog pin.</span>
<span class="kt">int</span><span class="w"> </span><span class="n">photoCellPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A0</span><span class="p">;</span>

<span class="c1">// The output analog LED pin.</span>
<span class="kt">int</span><span class="w"> </span><span class="n">ledPin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Initialize pins.</span>
<span class="w">  </span><span class="n">pinMode</span><span class="p">(</span><span class="n">photoCellPin</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT</span><span class="p">);</span>
<span class="w">  </span><span class="n">pinMode</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span><span class="w"> </span><span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Read value from photocell (between 0 and 1023).</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">photoCellPin</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Write value to LED (between 0 and 255).</span>
<span class="w">  </span><span class="n">analogWrite</span><span class="p">(</span><span class="n">ledPin</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As explained in <a class="reference internal" href="why_plaquette.html"><span class="doc">Why Plaquette?</span></a> section, this simple code is made complicated by the fact
that the programmer needs to remember low-level information concerning the ranges
of raw number values (1023, 255, …) Furthermore, this code fails to adapt to changing
conditions such as the range of the ambient light.</p>
<p>Let’s see how Plaquette can help us to create more expressive code by using inputs and
outputs signals rather than meaningless raw numbers.</p>
<section id="step-1-direct-input-to-output">
<h2>Step 1 : Direct Input-to-Output<a class="headerlink" href="#step-1-direct-input-to-output" title="Link to this heading"></a></h2>
<p>To begin, we will re-implement the example above, by using a more “expressive” code.</p>
<p>First, let’s define our input photocell on pin <code class="docutils literal notranslate"><span class="pre">A0</span></code> using an <a class="reference internal" href="AnalogIn.html"><span class="doc">AnalogIn</span></a> unit:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">AnalogIn</span><span class="w"> </span><span class="nf">photoCell</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span>
</pre></div>
</div>
<p>Then, let’s add an output analog LED on pin <cite>9</cite> using an <a class="reference internal" href="AnalogOut.html"><span class="doc">AnalogOut</span></a> unit:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">AnalogOut</span><span class="w"> </span><span class="nf">led</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
</pre></div>
</div>
<p>If we want to directly control the value of the LED from the value of the
photocell, all we need to do is to send the photocell’s value to the led. The
easiest way to do so is by using the <a class="reference internal" href="pipe.html"><span class="doc">&gt;&gt;</span></a> operator:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">photoCell</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">led</span><span class="p">;</span>
</pre></div>
</div>
<p>The complete Plaquette code will look like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Plaquette.h&gt;</span><span class="c1"> // include the Plaquette library</span>

<span class="c1">// Create input unit for photocell.</span>
<span class="n">AnalogIn</span><span class="w"> </span><span class="nf">photoCell</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span>

<span class="c1">// Create output unit for LED.</span>
<span class="n">AnalogOut</span><span class="w"> </span><span class="nf">led</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>

<span class="c1">// Initialize everything.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">begin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>

<span class="c1">// Define frame-by-frame operations.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">step</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Send photocell value directly to the LED.</span>
<span class="w">  </span><span class="n">photoCell</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">led</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step-2-getting-the-full-range-of-the-signal">
<h2>Step 2 : Getting the Full Range of the Signal<a class="headerlink" href="#step-2-getting-the-full-range-of-the-signal" title="Link to this heading"></a></h2>
<p>If we run this program, we will likely notice that the LED brightness will not
span the full range from 0% to 100%. That’s because depending on ambient lighting
conditions, the photocell’s values will not move across the full spectrum of
possibility. For instance, in the dark, the photocell might range from 10% to 50%,
while in full daylight, it might range between 70% and 95%.</p>
<p>In order to resolve this issue, we need to <strong>regularize</strong> the photocell’s signal.
We can do so using a filtering unit such as a <a class="reference internal" href="MinMaxScaler.html"><span class="doc">MinMaxScaler</span></a>. This unit automatically
keeps track of the minimum and maximum values of the incoming signal over time
(for example, 10% and 50%) and remaps them into a new interval of [0, 1] (ie., 0% to 100%).</p>
<img alt="_images/Plaquette-MinMaxScaler.png" src="_images/Plaquette-MinMaxScaler.png" />
<p>To use this approach, create the unit:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">MinMaxScaler</span><span class="w"> </span><span class="n">regularizer</span><span class="p">;</span>
</pre></div>
</div>
<p>… and then <em>insert it</em> in the pipeline between the incoming photocell signal and
the output LED:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">photoCell</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">regularizer</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">led</span><span class="p">;</span>
</pre></div>
</div>
<p>The above expression will do the following, in order:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Read the raw photocell value using the <code class="docutils literal notranslate"><span class="pre">photoCell</span></code> unit.</p></li>
<li><p>Send that raw value from the <code class="docutils literal notranslate"><span class="pre">photoCell</span></code> unit to the <code class="docutils literal notranslate"><span class="pre">regularizer</span></code> unit.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">regularizer</span></code> unit updates itself if the value is a new extreme value (minimum or maximum).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">regularizer</span></code> then remaps the raw photocell value to the full range of [0, 1] and sends it to the <code class="docutils literal notranslate"><span class="pre">led</span></code> unit.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">led</span></code> unit takes the input value in [0, 1] and applies it to the intensity of the LED.</p></li>
</ol>
</div></blockquote>
</section>
<section id="step-3-reacting-to-signal-changes">
<h2>Step 3 : Reacting to Signal Changes<a class="headerlink" href="#step-3-reacting-to-signal-changes" title="Link to this heading"></a></h2>
<p>Remember our example from <a class="reference internal" href="why_plaquette.html"><span class="doc">ealier</span></a>, where we were trying to detect high-valued
signals using arbitrary numbers?</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">716</span><span class="p">)</span>
<span class="w">  </span><span class="c1">// do something</span>
</pre></div>
</div>
<p>Suppose that instead of directly controlling the LED value based on the photocell’s
value, we instead want to use sudden changes in the photocell’s value to
trigger the on/off state of the LED? In other words, we would like to work with the <strong>peaks</strong> in the
incoming signal (such as when someone points a light source towards the photocell).</p>
<p>One way to do so would be to pick a threshold in the regularized signal
above which we would react to the light source. Let’s say that we will react
when the signal goes above 70%. The code of the <code class="docutils literal notranslate"><span class="pre">step()</span></code> function now
becomes:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">step</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">photoCell</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">regularizer</span><span class="p">;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">regularizer</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.7</span><span class="p">)</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">led</span><span class="p">;</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">led</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>… which can be more compactly rewritten by sending directly the conditional
expression <code class="docutils literal notranslate"><span class="pre">(regularizer</span> <span class="pre">&gt;</span> <span class="pre">0.7)</span></code> to the output LED:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">step</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">photoCell</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">regularizer</span><span class="p">;</span>
<span class="w">  </span><span class="p">(</span><span class="n">regularizer</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.7</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">led</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step-4-adapting-to-changing-conditions">
<h2>Step 4 : Adapting to Changing Conditions<a class="headerlink" href="#step-4-adapting-to-changing-conditions" title="Link to this heading"></a></h2>
<p>So far so good. The number 0.7 is still a bit of an arbitrary, hand-picked number, but it makes
more sense than 716 because it refers to a more human-understandable concept
(70% instead of 716 / 1023). However, this approach will still be sensitive to changes in
the ambient light, and behave differently under different light conditions (for example, it might
work as expected in the morning, but work less well in the late afternoon when the sun starts to go down.)</p>
<p>One thing we could do would be to make sure that our regularization unit adapts
to changing conditions. In order to do this, rather than having our MinMaxScaler
remap values depending on every single incoming value, we can have it
adapt over a <strong>time window</strong>. This will allow our regularizer to slowly forget
what it has learned, and reprogram itself after a certain amount of time has passed.</p>
<p>This can be accomplished by calling the <code class="docutils literal notranslate"><span class="pre">timeWindow(seconds)</span></code> function inside
the <code class="docutils literal notranslate"><span class="pre">begin()</span></code> function:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">begin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Allow regularizer to adapt over an approximate period of 1 hour (3600 s).</span>
<span class="w">  </span><span class="n">regularizer</span><span class="p">.</span><span class="n">timeWindow</span><span class="p">(</span><span class="mf">3600.0f</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step-5-detecting-outliers">
<h2>Step 5 : Detecting Outliers<a class="headerlink" href="#step-5-detecting-outliers" title="Link to this heading"></a></h2>
<p>The MinMaxScaler is a very useful unit for making sure signals stay within a
[0, 1] range. However, it is not always the best for signal detection since it
only accounts for extreme values (minimum and maximum), which makes it sensitive
to rare events. Someone switching the lights on and off again rapidly might completely
ruin the show.</p>
<p>A better alternative is the <a class="reference internal" href="Normalizer.html"><span class="doc">Normalizer</span></a> unit, which regularizes incoming signals
by normalizing them around a target <strong>mean</strong> by taking into account <strong>standard deviation</strong>.
Once the data is normalized, extreme <strong>outlier</strong> values can be more easily and robustly detected
based on how much they diverge from the mean.</p>
<p>Let’s replace our MinMaxScaler by a Normalizer unit:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Normalizer</span><span class="w"> </span><span class="n">regularizer</span><span class="p">;</span>
</pre></div>
</div>
<p>… and use the <code class="docutils literal notranslate"><span class="pre">isHighOutlier()</span></code> function to find values that are higher
than usual:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">step</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">photoCell</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">regularizer</span><span class="p">;</span>
<span class="w">  </span><span class="n">regularizer</span><span class="p">.</span><span class="n">isHighOutlier</span><span class="p">(</span><span class="n">photoCell</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">led</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">isHighOutlier()</span></code> function detects values that are more than
1.5 deviations from the mean. The function can be made more or less sensitive by
adjusting the number of deviations (typically between 1.0 and 3.0). For example,
<code class="docutils literal notranslate"><span class="pre">isHighOutlier(value,</span> <span class="pre">1.2)</span></code> will be more sensitive,
<code class="docutils literal notranslate"><span class="pre">isHighOutlier(value,</span> <span class="pre">2.5)</span></code> will be less sensitive, and <code class="docutils literal notranslate"><span class="pre">isHighOutlier(value,</span> <span class="pre">3.0)</span></code>
will only respond to rarely-occuring extremes. While these numbers (1.2, 1.5, 2.5, etc.)
still need to be hand-picked, they are much more robust than our 716 and even to
our 0.7 number from earlier.</p>
</div>
<p>Here is a complete version of the code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Plaquette.h&gt;</span><span class="c1"> // include the Plaquette library</span>

<span class="c1">// Create input unit for photocell.</span>
<span class="n">AnalogIn</span><span class="w"> </span><span class="nf">photoCell</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span>

<span class="c1">// Create output unit for LED.</span>
<span class="n">AnalogOut</span><span class="w"> </span><span class="nf">led</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>

<span class="c1">// Create regularization object.</span>
<span class="n">Normalizer</span><span class="w"> </span><span class="n">regularizer</span><span class="p">;</span>

<span class="c1">// Initialize everything.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">begin</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Allow regularizer to adapt over an approximate period of 1 hour (3600 s).</span>
<span class="w">  </span><span class="n">regularizer</span><span class="p">.</span><span class="n">timeWindow</span><span class="p">(</span><span class="mf">3600.0f</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Define frame-by-frame operations.</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">step</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Update regularizer with raw signal value.</span>
<span class="w">  </span><span class="n">photoCell</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">regularizer</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Detect outliers and send the value (1=true=outlier, 0=false=no outlier)</span>
<span class="w">  </span><span class="c1">// directly to the LED.</span>
<span class="w">  </span><span class="n">regularizer</span><span class="p">.</span><span class="n">isHighOutlier</span><span class="p">(</span><span class="n">photoCell</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">led</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step-6-detecting-peaks">
<h2>Step 6 : Detecting Peaks<a class="headerlink" href="#step-6-detecting-peaks" title="Link to this heading"></a></h2>
<p>The outlier detection method is useful to find extreme values. However, it also
comes with an important limitation. The <code class="docutils literal notranslate"><span class="pre">isHighOutlier()</span></code> and <code class="docutils literal notranslate"><span class="pre">isOutlierLow()</span></code>
methods return <code class="docutils literal notranslate"><span class="pre">true</span></code> <em>as long as</em> the received value is considered to be an
outlier, making these methods unsuitable for triggering instantanous events, such as
toggling the status of an LED, starting a sound event, activating a motor, etc.</p>
<p>The <a class="reference internal" href="PeakDetector.html"><span class="doc">PeakDetector</span></a> unit addresses this limitation. It is best used in combination
with a Normalizer unit. We will use the default mode of the PeakDetector (<code class="docutils literal notranslate"><span class="pre">PEAK_MAX</span></code>):
for a peak to be detected. In this mode, the signal will need to (1) cross a <em>trigger threshold</em> value
(<code class="docutils literal notranslate"><span class="pre">triggerThreshold</span></code>); (2) reach its <em>apex</em> (max); and (3) <em>fall back</em> by a certain
proportion (%) between the threshold and the apex (controlled by the <code class="docutils literal notranslate"><span class="pre">fallbackTolerance</span></code>
parameter).</p>
<img alt="_images/Plaquette-PeakDetector.png" src="_images/Plaquette-PeakDetector.png" />
<p>Building on the previous section for outlier detection, we will assign the PeakDetector’s
<code class="docutils literal notranslate"><span class="pre">triggerThreshold</span></code> to the value above which a value is considered to be a high outlier,
which can be obtained by calling the Normalizer’s function <code class="docutils literal notranslate"><span class="pre">highOutlierThreshold()</span></code>:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">PeakDetector</span><span class="w"> </span><span class="nf">detector</span><span class="p">(</span><span class="n">normalizer</span><span class="p">.</span><span class="n">highOutlierThreshold</span><span class="p">());</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As for the <code class="docutils literal notranslate"><span class="pre">isHighOutlier()</span></code> function, the <code class="docutils literal notranslate"><span class="pre">highOutlierThreshold()</span></code> function
is set to return, by default, a threshold that is 1.5 standard deviations from the mean. The
function can be made more or less sensitive by adjusting the number of deviations.
For example, <code class="docutils literal notranslate"><span class="pre">highOutlierThreshold(1.2)</span></code> will be more sensitive, while
<code class="docutils literal notranslate"><span class="pre">highOutlierThreshold(2.5)</span></code> will be less sensitive.</p>
</div>
<p>Finally, let’s rewrite the <code class="docutils literal notranslate"><span class="pre">step()</span></code> function with our new peak detector, so
that only when a <strong>peak</strong> is detected will the LED change state:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">step</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Signal is normalized and sent to peak detector.</span>
<span class="w">  </span><span class="n">sensor</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">normalizer</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">detector</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Toggle LED when peak detector triggers.</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">detector</span><span class="p">)</span>
<span class="w">    </span><span class="n">led</span><span class="p">.</span><span class="n">toggle</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The PeakDetector unit offers many options to fine-tune the peak detection process.
Please read the <a class="reference internal" href="PeakDetector.html"><span class="doc">full documentation of the unit</span></a> for details.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="timing_basics.html" class="btn btn-neutral float-left" title="Working with Time" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="advanced.html" class="btn btn-neutral float-right" title="Advanced Usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2025, Plaquette.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>